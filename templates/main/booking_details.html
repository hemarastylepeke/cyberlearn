{% extends 'main/loginbase.html' %}
{% load static %}

{% block content %}
<div class="text-base text-slate-500 border-b border-slate-200">
    <div class="flex flex-col gap-4 mb-6">
        <div class="flex flex-row gap-4 items-center">
            <div class="bg-gradient-to-r from-blue-600 to-blue-950 w-[10px] h-[25px] rounded-lg"></div>
            <h1 class="font-bold text-lg">{{ booking.first_name }}'s project details</h1>
        </div>
        <p class="text-sm leading-6">
            View and manage {{ booking.first_name }}'s project details from this page.
        </p>
    </div>
</div>  

{% if booking %} 
    <!-- Booking Details Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">

        <!-- Personal Information Card -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-blue-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-slate-500">Client's personal Information</h3>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Name</span>
                    <span class="text-slate-500 text-sm">{{ booking.first_name }} {{ booking.last_name }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Email</span>
                    <span class="text-slate-500 text-sm">{{ booking.email }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Phone</span>
                    <span class="text-slate-500 text-sm">{{ booking.phone|default:"Not provided" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Organization</span>
                    <span class="text-slate-500 text-sm">{{ booking.organization|default:"Not provided" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Region</span>
                    <span class="text-slate-500 text-sm">{{ booking.region|default:"Not provided" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">How they heard about us</span>
                    <span class="text-slate-500 text-sm">{{ booking.how_did_you_hear|default:"Not provided" }}</span>
                </div>
            </div>
        </div>

        <!-- Booking Status Card -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="p-2 bg-green-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-green-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c0 .621-.504 1.125 1.125 1.125H18a2.25 2.25 0 0 0 2.25-2.25M6 7.5h3v3H6v-3Z" />
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-slate-500">Project Status</h3>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between border-b border-slate-200 py-2 items-center">
                    <span class="text-slate-600 text-sm font-semibold">Status</span>
                    <span class="px-3 py-1 rounded-full text-sm font-medium {% if booking.status == 'completed' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                        {{ booking.status|capfirst }}
                    </span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Created</span>
                    <span class="text-slate-500 text-sm">{{ booking.created_at|date:"M d, Y H:i" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Assigned Developer</span>
                    <span class="text-slate-500 text-sm">
                        {% if booking.assigned_interpreter %}
                            {{ booking.assigned_interpreter.get_full_name|default:booking.assigned_interpreter.username }}
                        {% else %}
                            <span class="text-slate-500">Not assigned</span>
                        {% endif %}
                    </span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Assigned At</span>
                    <span class="text-slate-500 text-sm">{{ booking.assigned_at|date:"M d, Y H:i"|default:"Not assigned" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Scheduled Date</span>
                    <span class="text-slate-500 text-sm">{{ booking.scheduled_date|date:"M d, Y H:i"|default:"Not scheduled" }}</span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Duration</span>
                    <span class="text-slate-500 text-sm">
                        {% if booking.duration_minutes %}
                            {{ booking.duration_minutes }} minutes
                        {% else %}
                            Not specified
                        {% endif %}
                    </span>
                </div>
                <div class="flex justify-between border-b border-slate-200 py-2">
                    <span class="text-slate-600 text-sm font-semibold">Completed At</span>
                    <span class="text-slate-500 text-sm">{{ booking.completed_at|date:"M d, Y H:i"|default:"Not completed" }}</span>
                </div>
            </div>
        </div>

        <!-- Additional Details -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 py-8 px-6 lg:col-span-2">
            <div class="flex items-center gap-3 mb-4">
                <div class="p-2 bg-purple-100 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-purple-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.605 1.094 3.045 2.622 3.45.135.036.262.07.378.098C3.751 16.775 3.75 18.25 3.75 19.5A2.25 2.25 0 0 0 6 21.75h12a2.25 2.25 0 0 0 2.25-2.25c0-1.25-.001-2.725-.378-4.102.135-.027.262-.062.378-.098 1.528-.405 2.622-1.845 2.622-3.45 0-3-3-5.625-6.75-5.625S9 8.51 9 11.51c0 1.605 1.094 3.045 2.622 3.45.135.036.262.07.378.098C12.249 16.725 12.25 18.2 12.25 19.5v-.75" />
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-slate-500">Additional Details</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-slate-500 mb-2 font-semibold">Required Language</h4>
                    <p class="text-slate-700 bg-slate-50 text-sm p-3 rounded-lg">
                        {{ booking.required_language|default:"Not specified" }}
                    </p>
                </div>
                <div>
                    <h4 class="font-medium text-slate-500 text-sm mb-2 font-semibold">Admin Notes</h4>
                    <p class="text-slate-700 bg-slate-50 text-sm p-3 rounded-lg">
                        {{ booking.admin_notes|default:"No notes added" }}
                    </p>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-medium text-slate-500 text-sm mb-2 font-semibold">Customer Message</h4>
                <div class="bg-slate-50 text-sm p-4 rounded-lg">
                    <p class="text-slate-700 leading-relaxed">{{ booking.message }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Booking Modal -->
    <div id="updateModal" class="fixed inset-0 bg-black/30 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-slate-900">Update Booking Details</h2>
                    <button onclick="closeUpdateModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <form method="post" action="{% url 'booking_details' booking.id %}" class="p-6">
                {% csrf_token %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Status -->
                    <div class="md:col-span-2">
                        <label for="status" class="block text-sm font-medium text-slate-700 mb-2">Status</label>
                        <select name="status" id="status" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="pending" {% if booking.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="completed" {% if booking.status == 'completed' %}selected{% endif %}>Completed</option>
                        </select>
                    </div>

                    <!-- Assigned Interpreter -->
                    <div class="md:col-span-2">
                        <label for="assigned_interpreter" class="block text-sm font-medium text-slate-700 mb-2">Assigned Interpreter</label>
                        <select name="assigned_interpreter" id="assigned_interpreter" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select an interpreter...</option>
                            {% for interpreter in interpreters %}
                                <option value="{{ interpreter.id }}" {% if booking.assigned_interpreter.id == interpreter.id %}selected{% endif %}>
                                    {{ interpreter.username }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Scheduled Date -->
                    <div>
                        <label for="scheduled_date" class="block text-sm font-medium text-slate-700 mb-2">Scheduled Date</label>
                        <input type="datetime-local" name="scheduled_date" id="scheduled_date" 
                               value="{{ booking.scheduled_date|date:'Y-m-d\TH:i' }}"
                               class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- Duration -->
                    <div>
                        <label for="duration_minutes" class="block text-sm font-medium text-slate-700 mb-2">Duration (minutes)</label>
                        <input type="number" name="duration_minutes" id="duration_minutes" 
                               value="{{ booking.duration_minutes }}" min="1"
                               class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- Required Language -->
                    <div>
                        <label for="required_language" class="block text-sm font-medium text-slate-700 mb-2">Interpretation Language</label>                        
                        <select name="required_language" id="required_language" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option selected>Choose a language</option>
                            <option value="Swahili">Swahili</option>
                            <option value="Somali">Somali</option>
                            <option value="Oromo">Oromo</option>
                            <option value="Arabic">Arabic</option>
                        </select>
                    </div>

                    <!-- Phone -->
                    <div>
                        <label for="phone" class="block text-sm font-medium text-slate-700 mb-2">Phone</label>
                        <input type="tel" name="phone" id="phone" value="{{ booking.phone }}" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- Admin Notes -->
                    <div class="md:col-span-2">
                        <label for="admin_notes" class="block text-sm font-medium text-slate-700 mb-2">Admin Notes</label>
                        <textarea name="admin_notes" id="admin_notes" rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ booking.admin_notes }}</textarea>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-slate-200">
                    <button type="button" onclick="closeUpdateModal()" 
                            class="px-4 py-2 hover:cursor-pointer ease-in duration-300 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-2 hover:cursor-pointer ease-in duration-300 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                        Update Booking
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black/30 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6 flex flex-col items-center justify-center text-center">
                <div class="flex flex-col items-center justify-center gap-4 mb-4">
                    <div class="flex items-center justify-center text-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-14 h-14">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">Delete Booking</h3>
                        <p class="text-slate-600 text-sm">Are you sure you want to delete this booking? This action cannot be undone.</p>
                    </div>
                </div>
                <div class="flex justify-center gap-3 mt-6">
                    <button onclick="closeDeleteModal()" 
                            class="px-4 py-2 text-slate-600 text-sm bg-slate-100 hover:bg-slate-200 rounded-lg font-medium transition-colors hover:cursor-pointer ease-in duration-300">
                        Cancel
                    </button>
                    <form method="post" action="{% url 'delete_booking' booking.id %}">
                        {% csrf_token %}
                        <button type="submit" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-sm text-white rounded-lg font-medium transition-colors hover:cursor-pointer ease-in duration-300"> Delete </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 mb-6 pt-4">
        <button onclick="openUpdateModal()" class="bg-blue-600 hover:bg-blue-700 text-slate-200 text-sm px-4 py-2 rounded-lg font-medium transition-colors hover:cursor-pointer ease-in duration-300 duration-200 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
            </svg>
            Update Project
        </button>
        <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 ease-in hover:cursor-pointer text-slate-200 text-sm px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
            </svg>
            Delete Project
        </button>
    </div>

{% else %}
<p class="bg-blue-600/5 rounded-2xl mt-3 border border-blue-200/40 text-blue-800 p-8 text-center gap-3 items-center flex flex-col">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
        <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
    </svg>
    <span>Sorry, we could not retrieve data associated with this booking!.</span>
</p>
{% endif %}

<script>
    function openUpdateModal() {
        document.getElementById('updateModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeUpdateModal() {
        document.getElementById('updateModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function confirmDelete() {
        document.getElementById('deleteModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(event) {
        const updateModal = document.getElementById('updateModal');
        const deleteModal = document.getElementById('deleteModal');
        
        if (event.target === updateModal) {
            closeUpdateModal();
        }
        
        if (event.target === deleteModal) {
            closeDeleteModal();
        }
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeUpdateModal();
            closeDeleteModal();
        }
    });
</script>

{% endblock content %}